sudo: false
dist: trusty
language: java
jdk: [oraclejdk8]
before_install: [echo $GPG_SECRET_KEYS | base64 --decode | $GPG_EXECUTABLE --import,
  echo $GPG_OWNERTRUST | base64 --decode | $GPG_EXECUTABLE --import-ownertrust]
install: mvn --settings .maven.xml install -DskipTests=true -Dgpg.skip -Dmaven.javadoc.skip=true
  -B -V
before_deploy: ['mvn help:evaluate -N -Dexpression=project.version|grep -v ''\[''',
  'export project_version=$(mvn help:evaluate -N -Dexpression=project.version|grep
    -v ''\['')', export TRAVIS_TAG=v$project_version]
cache:
  directories: [~/.m2/repository]
deploy:
  api_key: $GITHUB_TOKEN
  file_glob: true
  file: [$TRAVIS_BUILD_DIR/**/target/sentilo-*-$project_version.jar, $TRAVIS_BUILD_DIR/**/target/sentilo-*.war,
    $TRAVIS_BUILD_DIR/sentilo-platform/**/target/sentilo-*-$project_version.jar]
  name: v$project_version
  overwrite: true
  provider: releases
  skip_cleanup: true
  true: {repo: sentilo/sentilo, tags: true}
after_deploy: ['mvn clean cobertura:cobertura coveralls:cobertura', mvn clean deploy
    --settings .maven.xml -DskipTests=true -B -U -Possrh]
branches:
  only: [sentilo/sentilo-61-origin]
